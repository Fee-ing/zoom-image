!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["fee-zoom-image"]=e():t["fee-zoom-image"]=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,o)=>{for(var i in o)t.o(o,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:o[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>o});const o=class{constructor(t={}){this.options={className:"zoom-image",minWidth:100,duration:.3,enableWheelScale:!0,enableDragMove:!0,...t},this.options.className=(this.options.className||"")+"",isNaN(this.options.minWidth)?this.options.minWidth=100:(this.options.minWidth=parseInt(this.options.minWidth||100),this.options.minWidth>500&&(this.options.minWidth=500),this.options.minWidth<20&&(this.options.minWidth=20)),isNaN(this.options.duration)?this.options.duration=.3:(this.options.duration=parseFloat(parseFloat(this.options.duration||.3).toFixed(2)),this.options.duration>1&&(this.options.duration=1),this.options.duration<0&&(this.options.duration=0)),this.options.enableWheelScale=Boolean(this.options.enableWheelScale),this.options.enableDragMove=Boolean(this.options.enableDragMove),this.imageSrc="",this.srcType="",this.originWidth=0,this.originHeight=0,this.zoomWidth=0,this.zoomHeight=0,this.offsetLeft=0,this.offsetTop=0,this.scrollLeft=0,this.scrollTop=0,this.scaleX=1,this.scaleY=1,this.translateX=0,this.translateY=0,this.wheelTimes=1,this.transitionFlag=!1,this.listeners={},this.init()}reset(){this.imageSrc="",this.srcType="",this.originWidth=0,this.originHeight=0,this.zoomWidth=0,this.zoomHeight=0,this.offsetLeft=0,this.offsetTop=0,this.scrollLeft=0,this.scrollTop=0,this.scaleX=1,this.scaleY=1,this.translateX=0,this.translateY=0,this.wheelTimes=1,this.transitionFlag=!1}on(t,e){return void 0===this.listeners[t]&&(this.listeners[t]=[]),"function"==typeof e&&this.listeners[t].push(e),this}off(t,e){let o=this.listeners[t];if("string"==typeof t&&o instanceof Array)if("function"==typeof e){for(let i=0,n=o.length;i<n;i+=1)if(o[i]===e){this.listeners[t].splice(i,1);break}}else delete this.listeners[t];return this}emit(t,e={}){let o=this.listeners[t];if(o instanceof Array)for(let i=0,n=o.length;i<n;i+=1)"function"==typeof o[i]&&o[i]({type:t,...e});return this}getElementLeft(t){return this.offsetLeft+=t.offsetLeft||0,t.offsetParent?this.getElementLeft(t.offsetParent):this.offsetLeft}getElementTop(t){return this.offsetTop+=t.offsetTop||0,t.offsetParent?this.getElementTop(t.offsetParent):this.offsetTop}getScrollLeft(t){return this.scrollLeft+=t.scrollLeft||0,t.parentNode?this.getScrollLeft(t.parentNode):this.scrollLeft}getScrollTop(t){return this.scrollTop+=t.scrollTop||0,t.parentNode?this.getScrollTop(t.parentNode):this.scrollTop}getElementCss(t,e){return"getComputedStyle"in window?window.getComputedStyle(t,null)[e]:t.currentStyle[e]}createImageElement(t,e){let o=new Image;if(o.src=t,o.complete)e&&e(o);else{o.onload=function(){e&&e(o),o.onload=null};let t=this;o.onerror=function(){t.emit("error",{message:"获取图片失败"}),o=null}}}addEvent(t,e,o){t.addEventListener?t.addEventListener(e,o,!1):t.attachEvent?t.attachEvent(`on${e}`,o):t[`on${e}`]=o}init(){const t=this;document.onclick=function(e){e.stopPropagation();const o=e.target;!t.options.className||o.className.indexOf(t.options.className)<0||(t.reset(),o.src?(t.imageSrc=o.src,t.srcType="1"):(t.imageSrc=t.getElementCss(o,"background-image"),t.imageSrc&&(t.imageSrc=t.imageSrc.replace(/(^url\(('|"){1})|(('|"){1}\)$)/g,""),t.srcType="2")),t.imageSrc?/\.(png|jpg|gif|jpeg|webp)$/.test(t.imageSrc)?t.createImageElement(t.imageSrc,(e=>{const i=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight;t.offsetLeft=t.getElementLeft(o),t.offsetTop=t.getElementTop(o),t.scrollLeft=t.getScrollLeft(o),t.scrollTop=t.getScrollTop(o),t.offsetLeft-=t.scrollLeft,t.offsetTop-=t.scrollTop,t.originWidth=o.offsetWidth,t.originHeight=o.offsetHeight;const s=e.width/e.height;t.zoomWidth=e.width<t.options.minWidth?t.options.minWidth:e.width,t.zoomHeight=t.zoomWidth/s,t.zoomWidth>.9*i&&(t.zoomWidth=.9*i,t.zoomHeight=t.zoomWidth/s),t.zoomHeight>.9*n&&(t.zoomHeight=.9*n,t.zoomWidth=t.zoomHeight*s),t.scaleX=t.zoomWidth/t.originWidth,t.scaleY=t.zoomHeight/t.originHeight,t.translateX=i/2-(t.offsetLeft+t.originWidth/2),t.translateY=n/2-(t.offsetTop+t.originHeight/2);let l=null,r=null;"1"===t.srcType?l=e:"2"===t.srcType&&(l=document.createElement("div"),r=document.createElement("div"),r.style.cssText+=`\n            position: absolute;\n            left: 0px;\n            top: 0px;\n            z-index: 1;\n            width: 100%;\n            height: 100%;\n            opacity: 1;\n            transition: opacity ${t.options.duration}s;\n            background-repeat: no-repeat;\n            background-image: url(${t.imageSrc});\n            background-size: ${t.getElementCss(o,"background-size")};\n            background-position: ${t.getElementCss(o,"background-position")};\n          `,e.style.cssText+=`\n            position: absolute;\n            left: 0px;\n            top: 0px;\n            z-index: 2;\n            width: 100%;\n            height: 100%;\n            opacity: 0;\n            transition: opacity ${t.options.duration}s;\n          `,l.appendChild(r),l.appendChild(e)),l.style.cssText+=`\n          position: absolute;\n          width: ${t.originWidth}px;\n          height: ${t.originHeight}px;\n          left: ${t.offsetLeft}px;\n          top: ${t.offsetTop}px;\n          transition: transform ${t.options.duration}s;\n          overflow: hidden;\n        `;let a=document.createElement("div");function h(e){let o=!1;((e=e||window.event).wheelDelta?e.wheelDelta:40*-e.detail)>0?t.wheelTimes+=t.wheelTimes<1?.2:.5:(t.wheelTimes-=t.wheelTimes<=1?.2:.5,o=!0),t.wheelTimes>5?t.wheelTimes=5:t.wheelTimes<.2?t.wheelTimes=.2:(o&&(t.translateX=i/2-(t.offsetLeft+t.originWidth/2),t.translateY=n/2-(t.offsetTop+t.originHeight/2)),l.style.cssText+=`\n            transition: transform ${t.options.duration}s;\n            cursor: ${t.wheelTimes>1?"move":"auto"};\n            transform: translate(${t.translateX}px, ${t.translateY}px) scale(${t.scaleX*t.wheelTimes}, ${t.scaleY*t.wheelTimes});\n          `)}if(a.style.cssText+=`\n          position: fixed;\n          top: 0px;\n          left: 0px;\n          z-index: 1001;\n          width: 100%;\n          height: 100%;\n          overflow: hidden;\n          transition: background-color ${t.options.duration}s;\n          transform: translate3d(0, 0, 0);\n        `,a.appendChild(l),document.body.appendChild(a),setTimeout((()=>{a.style.cssText+="background-color: rgba(0, 0, 0, 0.55);",l.style.cssText+=`\n            transform: translate(${t.translateX}px, ${t.translateY}px) scale(${t.scaleX}, ${t.scaleY});\n          `,"2"===t.srcType&&(r.style.cssText+="\n              opacity: 0;\n            ",e.style.cssText+="\n              opacity: 1;\n            ")})),t.options.enableWheelScale&&(t.addEvent(l,"mousewheel",h),t.addEvent(l,"DOMMouseScroll",h)),t.options.enableWheelScale&&t.options.enableDragMove){let e=!1,o=0,i=0,n=0,s=0;t.addEvent(l,"mousedown",(function(n){t.wheelTimes<=1||(e=!0,o=n.clientX,i=n.clientY,n.preventDefault(),n.stopPropagation())})),t.addEvent(l,"mousemove",(function(r){t.wheelTimes<=1||!e||(n=r.clientX-o,s=r.clientY-i,l.style.cssText+=`\n              transition: none;\n              transform: translate(${t.translateX+n}px, ${t.translateY+s}px) scale(${t.scaleX*t.wheelTimes}, ${t.scaleY*t.wheelTimes});\n            `,r.preventDefault(),r.stopPropagation())})),t.addEvent(l,"mouseup",(function(o){t.wheelTimes<=1||(e&&(t.translateX+=n,t.translateY+=s,n=0,s=0),e=!1,o.preventDefault(),o.stopPropagation())})),l.onclick=function(e){t.wheelTimes>1&&e.stopPropagation()}}a.onclick=function(o){o.stopPropagation(),a.style.backgroundColor="",l.style.cssText+=`\n            transition: transform ${t.options.duration}s;\n            transform: none;\n          `,"2"===t.srcType&&(r.style.cssText+="\n              opacity: 1;\n            ",e.style.cssText+="\n              opacity: 0;\n            ")},a.addEventListener("transitionend",(function(o){"background-color"===o.propertyName&&(t.transitionFlag?(document.body.removeChild(a),a=null,l=null,e=null,r=null,t.transitionFlag=!1):t.transitionFlag=!0)}),!1)})):t.emit("error",{message:"不支持该格式"}):t.emit("error",{message:"获取图片失败"}))}}};return e})()}));